{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "languageVersion": "2.0",
  "contentVersion": "1.0.0.0",
  "metadata": {
    "_generator": {
      "name": "bicep",
      "version": "0.37.4.10188",
      "templateHash": "13346759706367229692"
    },
    "name": "Microsoft Graph App Role Assignment",
    "description": "Creates and configures app role assignments for users, groups, or service principals",
    "owner": "Platform Team"
  },
  "parameters": {
    "appRoleId": {
      "type": "string",
      "metadata": {
        "examples": [
          "00000000-0000-0000-0000-000000000001",
          "df021288-bdef-4463-88db-98f22de89214"
        ],
        "description": "Required. The ID of the app role being assigned"
      }
    },
    "principalId": {
      "type": "string",
      "metadata": {
        "examples": [
          "12345678-1234-1234-1234-123456789012",
          "87654321-4321-4321-4321-210987654321",
          "abcdef12-3456-7890-abcd-ef1234567890"
        ],
        "description": "Required. The object ID of the principal (user, group, or service principal) receiving the role"
      }
    },
    "resourceId": {
      "type": "string",
      "metadata": {
        "examples": [
          "fedcba98-7654-3210-fedc-ba9876543210"
        ],
        "description": "Required. The object ID of the resource (application or service principal) that defines the app role"
      }
    },
    "resourceDisplayName": {
      "type": "string",
      "metadata": {
        "examples": [
          "My API Application",
          "Microsoft Graph",
          "SharePoint Online"
        ],
        "description": "Required. The display name of the resource app's service principal to which the assignment is made"
      }
    },
    "principalType": {
      "type": "string",
      "defaultValue": "ServicePrincipal",
      "allowedValues": [
        "User",
        "Group",
        "ServicePrincipal"
      ],
      "metadata": {
        "description": "Optional. The type of principal receiving the role (for documentation purposes only)"
      }
    }
  },
  "imports": {
    "microsoftGraphV1": {
      "provider": "MicrosoftGraph",
      "version": "1.0.0"
    }
  },
  "resources": {
    "appRoleAssignment": {
      "import": "microsoftGraphV1",
      "type": "Microsoft.Graph/appRoleAssignedTo@v1.0",
      "properties": {
        "appRoleId": "[parameters('appRoleId')]",
        "principalId": "[parameters('principalId')]",
        "resourceId": "[parameters('resourceId')]",
        "resourceDisplayName": "[parameters('resourceDisplayName')]"
      },
      "metadata": {
        "description": "Microsoft Graph App Role Assignment"
      }
    }
  },
  "outputs": {
    "resourceId": {
      "type": "string",
      "metadata": {
        "description": "The resource ID of the app role assignment"
      },
      "value": "[reference('appRoleAssignment').id]"
    },
    "appRoleId": {
      "type": "string",
      "metadata": {
        "description": "The app role ID that was assigned"
      },
      "value": "[reference('appRoleAssignment').appRoleId]"
    },
    "principalId": {
      "type": "string",
      "metadata": {
        "description": "The principal ID that received the role"
      },
      "value": "[reference('appRoleAssignment').principalId]"
    },
    "assignedResourceId": {
      "type": "string",
      "metadata": {
        "description": "The resource ID that defines the app role"
      },
      "value": "[reference('appRoleAssignment').resourceId]"
    },
    "principalType": {
      "type": "string",
      "metadata": {
        "description": "The principal type"
      },
      "value": "[parameters('principalType')]"
    }
  }
}